<p><%= notice %></p>

<h1>本の詳細</h1>
<div class="row mb-5 mt-5 ">
  <div class="col-2">
    <%= link_to (image_tag @book.image,width:'100%'), @book.url%>
    <div class="row">
    <%= link_to '本のリンク', @book.url, class:"col-6" %>

    <div class="col-6">
      <% if @favorite.present? %>
        <%= render 'unfavorite' %>
      <% else %>
        <%= render 'favorite' %>
      <% end %>
    </div>
    </div>
  </div>
  <div class="col-7">
    <p class="h4 mb-5"><%= @book.title %></p>
    <p class="h4 mb-5"><%= @book.author %></p>
    <p class="h4"><%= @book.publisher_name %></p>
  </div>
</div>
<div class="row bg-light">
  <% @book.reviews.each do |review| %>
    <h3 class="col-12"><%= review.title %></h3>
    <p class="col-12">ニックネーム:<%= review.user.nickname %></p>
    <% review.ratings.each do |rating| %>
      <p class="col-1"><%= Category.find(rating.category_id).name %></p>
      <div class="col-11">
      <div class="rating_point">
        <%= rating.point %>
      </div>
      </div>
      <script>
        $('.rating_point').empty();
        $('.rating_point').raty({
          size :36,
          starHalf: '<%= asset_path('star-half.png') %>',
          starOff: '<%= asset_path('star-off.png') %>',
          starOn: '<%= asset_path('star-on.png') %>',
          half: true,
          readOnly: true,
          score: <%= rating.point %>
        });
      </script>
    <% end %>
  <p class="col-12 text-break"><%= review.content %></p>
  <% @like = review.likes.find_by(user: current_user) %>
  <% if @like.present? %>
    <p class="col-1"><%= render 'unlike' %></p>
  <% else %>
    <p class="col-1"><%= render 'like',review: review %></p>
  <% end %>
    <% if current_user.id == review.user_id %>
      <%= link_to 'レビューを編集', edit_book_review_path(review.id,book_id: @book.id), class:"col-12" %>
    <% end %>
  <% end %>
</div>


<%= link_to 'レビューを作成', new_book_review_path(@book.id,isbn: @book.isbn) %>
